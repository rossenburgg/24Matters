<style>
  @media (max-width: 992px) {
    .mobile-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding: 0 1rem;
      background-color: #000; /* Black background */
      height: 56px; /* Adjust height as needed */
      position: sticky; /* Make the header sticky */
      top: 0; /* Stick to the top */
      z-index: 1000; /* Ensure it stays on top of other content */
      color: white; /* White text color */
    }
    .mobile-header .brand-logo {
      display: flex;
      align-items: center;
    }
    .mobile-header .brand-logo img {
      height: 40px; /* Adjust logo height as needed */
    }
    .mobile-header .profile-icon {
      display: flex;
      align-items: center;
      justify-content: center;
      width: 40px; /* Adjust width as needed */
      height: 40px; /* Adjust height as needed */
      background-color: #1DB954; /* Spotify green */
      border-radius: 50%; /* Make it round */
      padding: 3px; /* Add padding to create a ring effect */
    }
    .mobile-header .profile-icon img {
      height: 100%; /* Make the image fill the container */
      width: 100%; /* Make the image fill the container */
      border-radius: 50%; /* Make the image itself round */
      background-color: white; /* Background color inside the green ring */
    }
    .desktop-header {
      display: none;
    }
  }

  @media (min-width: 993px) {
    .mobile-header {
      display: none;
    }
    .desktop-header {
      display: block;
    }
  }
</style>

<!-- Desktop Header -->
<header class="desktop-header">
  <nav class="navbar navbar-expand-md navbar-dark bg-dark">
    <a class="navbar-brand" href="/">24Matters</a>
    <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarNav" aria-controls="navbarNav" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>
    <div class="collapse navbar-collapse" id="navbarNav">
      <ul class="navbar-nav">
        <li class="nav-item">
          <a class="nav-link" href="/">Home</a>
        </li>
        <% if (session && session.userId) { %>
          <li class="nav-item">
            <a class="nav-link" href="/deposit">Deposit</a>
          </li>
          <li class="nav-item">
            <a class="nav-link" href="/tasks">Tasks</a>
          </li>
          <li class="nav-item">
            <a class="nav-link" href="/history">Transaction History</a>
          </li>
          <li class="nav-item">
            <a class="nav-link" href="/auth/setup2fa">Setup 2FA</a>
          </li>
          <li class="nav-item">
            <a class="nav-link" href="/analytics">Analytics</a>
          </li>
          <li class="nav-item">
            <a class="nav-link" href="/auth/logout">Logout</a>
          </li>
          <li class="nav-item dropdown">
            <a class="nav-link dropdown-toggle" href="#" id="notificationIcon" role="button" data-bs-toggle="dropdown" aria-expanded="false" data-user-id="<%= session.userId %>">
              <i class="bi bi-bell-fill"></i> <span id="notificationCount">0</span>
            </a>
            <ul class="dropdown-menu" aria-labelledby="notificationIcon" id="notificationDropdown">
              <li><a class="dropdown-item" href="#">No notifications</a></li>
            </ul>
          </li>
            <form class="form-inline my-2 my-lg-0">
              <button class="btn btn-outline-success my-2 my-sm-0" type="button" onclick="location.href='/set-light-theme'">Light Theme</button>
              <button class="btn btn-outline-secondary my-2 my-sm-0 ml-2" type="button" onclick="location.href='/set-dark-theme'">Dark Theme</button>
            </form>
        <% } else { %>
          <li class="nav-item">
            <a class="nav-link" href="/auth/login">Login</a>
          </li>
        <% } %>
      </ul>
    </div>
  </nav>
</header>

<!-- Mobile Header -->
<header class="mobile-header">
  <div class="brand-logo">
    <img src="https://upload.wikimedia.org/wikipedia/commons/2/26/Spotify_logo_with_text.svg" alt="Spotify Logo">
  </div>
  <div class="profile-icon">
    <img src="https://via.placeholder.com/24" alt="Profile Icon">
  </div>
</header>

<script src="/socket.io/socket.io.js"></script>
<script>
  document.addEventListener('DOMContentLoaded', function() {
    const socket = io();
    const notificationIcon = document.getElementById('notificationIcon');
    const notificationDropdown = document.getElementById('notificationDropdown');
    const notificationCount = document.getElementById('notificationCount');
    const userId = notificationIcon ? notificationIcon.getAttribute('data-user-id') : null;

    notificationIcon.addEventListener('click', function() {
      notificationDropdown.classList.toggle('show');
    });

    if (userId) {
      socket.on('connect', function() {
        socket.emit('register', userId);
      });

      socket.on('notification count', function(count) {
        notificationCount.innerText = count;
        if (count > 0) {
          fetch('/api/notifications')
            .then(response => response.json())
            .then(data => {
              const notifications = data.map(notification => 
                `<li><a class="dropdown-item" href="#">${notification.message}</a></li>`
              ).join('');
              notificationDropdown.innerHTML = notifications;
            })
            .catch(error => {
              console.error('Error fetching notifications:', error);
            });
        }
      });

      socket.on('new notification', function(notification) {
        const newNotification = `<li><a class="dropdown-item" href="#">${notification.message}</a></li>`;
        notificationDropdown.innerHTML = newNotification + notificationDropdown.innerHTML;
      });
    }
  });
</script>
